{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>学習統計</title>
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<style>
body{font-family:"Microsoft YaHei",sans-serif;background:#f5f6fa;text-align:center;margin:0}
h1{color:#2b7fff;margin:30px 0}
.row{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin:10px}
.card{background:#fff;border-radius:10px;box-shadow:0 3px 10px rgba(0,0,0,.1);padding:16px;min-width:280px}
.list{max-width:900px;margin:0 auto;text-align:left;padding:0 12px}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 3px 10px rgba(0,0,0,.08)}
td,th{padding:10px;border-bottom:1px solid #eee}
form{margin:16px 0}
button{background:#2b7fff;color:#fff;border:0;padding:8px 18px;border-radius:6px;cursor:pointer}
button:hover{background:#1a5fd3}
.danger{background:#ef4444}
.danger:hover{background:#dc2626}
</style>
</head>
<body>
    <h1>学習統計</h1>

    <form method="post" action="/stats/clear/" onsubmit="return confirm('確かにすべてを削除しますか');">
        {% csrf_token %}
        <button class="danger" type="submit">テスト記録をすべて削除</button>
    </form>

    {% if by_dict %}
    <div class="row">
        {% for item in by_dict %}
        <div class="card">
            <h3>{{ item.name }}</h3>
            <div>テスト回数：{{ item.times }}</div>
            <div>正解数合計：{{ item.correct }} / {{ item.total }}</div>
            <div>全体正答率：{{ item.acc }}%</div>
            <svg width="260" height="90">
                <rect x="10" y="20" width="240" height="18" fill="#e5e7eb"></rect>
                <rect x="10" y="20" width="{% widthratio item.acc 100 240 %}" height="18" fill="#2b7fff"></rect>
                <text x="130" y="35" text-anchor="middle" fill="#111827" font-size="16" font-weight="bold">{{ item.acc }}%</text>
            </svg>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="list">
        <h3>最近のテスト記録</h3>
        <table>
            <tr><th>単語リスト</th><th>スコア</th><th>正解/総数</th></tr>
            {% for x in logs reversed %}
            <tr>
                <td>{{ x.dict_name }}</td>
                <td>{{ x.score }}%</td>
                <td>{{ x.correct }}/{{ x.total }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="4">まだ記録がありません</td></tr>
            {% endfor %}
        </table>
    </div>

    <p style="margin:22px 0;"><a href="/home/"><button>ホームページ</button></a></p>
</body>
</html>
